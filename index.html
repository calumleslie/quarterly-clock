<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Quarterly Clock</title>
    <style>
        html, body {
            height: 100%;
        }
        div#container {
            width: 100%;
            height: 100%;
        }
    </style>
  </head>
  <body>
    <div id="container">
        <canvas id="clock"></canvas>
    </div>
  </body>
  <script src="https://unpkg.com/dayjs@1.8.21/dayjs.min.js"></script>
  <script src="https://unpkg.com/dayjs@1.8.21/plugin/weekOfYear.js"></script>
  <script>
    dayjs.extend(window.dayjs_plugin_weekOfYear);
    const container = document.getElementById("container");
    const { width, height } = container.getBoundingClientRect();

    var canvas = document.getElementById("clock");
    canvas.style.width = `${width}px`;
    canvas.style.height = `${height}px`;
    
    const context = canvas.getContext("2d");
    const scale = window.devicePixelRatio;
    canvas.width = Math.floor(width * scale);
    canvas.height = Math.floor(height * scale);
    context.scale(scale, scale);

    const centerX = width / 2;
    const centerY = height / 2;

    console.log("Hola, today is " + dayjs().format());
    const weekOfYear = dayjs().week();
    const yearFraction = weekOfYear / 52.0;
    
    const radius = Math.min(width, height) * 0.5 * 0.9;
    context.lineCap = "round";
    context.lineWidth = 20;
    context.beginPath();
    context.arc(centerX, centerY, radius, -0.5 * Math.PI, ((yearFraction * 2.0) - 0.5) * Math.PI);
    context.stroke();

    const quarter = Math.ceil(yearFraction * 4.0);
    context.textAlign = "center";
    const textHeight = Math.min(width, height) * 0.3;
    context.font = `${textHeight}px Arial`;
    context.fillText(`Q${quarter.toFixed(0)}`, centerX, centerY + (textHeight / 4.0)); 
  </script>
  <script defer data-domain="quarterly.houseofmoran.io" src="https://plausible.io/js/plausible.js"></script>
</html>